"""Google Gemini APIë¥¼ ì‚¬ìš©í•œ íŠ¸ë Œë“œ ë¶„ì„ê¸°"""

import os
import google.generativeai as genai
from datetime import datetime
import pytz


class TrendAnalyzer:
    """ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ Gemini APIë¡œ ë¶„ì„í•˜ëŠ” í´ë˜ìŠ¤"""

    def __init__(self):
        genai.configure(api_key=os.getenv("GEMINI_API_KEY"))
        self.model = genai.GenerativeModel('gemini-3-flash-preview')

    def analyze(self, collected_data: str) -> str:
        """ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ë¦¬í¬íŠ¸ ìƒì„±"""

        # í•œêµ­ ì‹œê°„
        kst = pytz.timezone('Asia/Seoul')
        now_kst = datetime.now(kst)
        timestamp = now_kst.strftime("%Y-%m-%d %H:%M KST")

        prompt = f"""ë‹¹ì‹ ì€ ê¸€ë¡œë²Œ íŠ¸ë Œë“œ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì•„ë˜ ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ í•œêµ­ì–´ë¡œ ê°„ê²°í•œ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

## ìˆ˜ì§‘ ì‹œê°„
{timestamp}

## ìˆ˜ì§‘ëœ ë°ì´í„°
{collected_data}

## ë¦¬í¬íŠ¸ ì‘ì„± ì§€ì¹¨
1. **ê°„ê²°í•˜ê²Œ**: ê° ì„¹ì…˜ì€ í•µì‹¬ë§Œ 3-5ê°œ bullet pointë¡œ ì‘ì„±
2. **ì¸ì‚¬ì´íŠ¸ ì¤‘ì‹¬**: ë‹¨ìˆœ ë‚˜ì—´ì´ ì•„ë‹Œ ì˜ë¯¸ìˆëŠ” ë¶„ì„ ì œê³µ
3. **í•œêµ­ ë…ì ê´€ì **: í•œêµ­ì— ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆëŠ” ë‚´ìš© ê°•ì¡°
4. **ì‹¤ìš©ì **: íˆ¬ì, ê¸°ìˆ  íŠ¸ë Œë“œ ë“± ì‹¤ì§ˆì ìœ¼ë¡œ ìœ ìš©í•œ ì •ë³´ ìœ„ì£¼
5. **ê°€ë…ì„±**: ê° í•­ëª© ì‚¬ì´ì— ë¹ˆ ì¤„ì„ ë„£ì–´ ì½ê¸° ì‰½ê²Œ ì‘ì„±

## ë¦¬í¬íŠ¸ í˜•ì‹ (ì•„ë˜ í˜•ì‹ì„ ì •í™•íˆ ë”°ë¼ì£¼ì„¸ìš”)

## 1. ì„¸ê³„ ì •ì„¸

â€¢ [í•µì‹¬ ì´ìŠˆ ìš”ì•½ - ì™œ ì¤‘ìš”í•œì§€]

â€¢ [ë‘ ë²ˆì§¸ ì´ìŠˆ]

â€¢ [ì„¸ ë²ˆì§¸ ì´ìŠˆ]


## 2. ì‹œì¥ ë¸Œë¦¬í•‘

### a. ì˜¤ëŠ˜ì˜ ì£¼ì‹íë¦„ ì „ë§

â€¢ [ë¯¸êµ­ ì£¼ì‹ì‹œì¥ ë°©í–¥ì„± ì „ë§ - ìƒìŠ¹/í•˜ë½/ë³´í•© ì˜ˆìƒ ë° ê·¼ê±°]

â€¢ [ì£¼ëª©í•  ì„¹í„°ì™€ ì´ìœ ]

### b. ì˜¤ëŠ˜ì˜ ìˆ˜í˜œì£¼ ë¶„ì„

â€¢ [í‹°ì»¤(ì¢…ëª©ëª…) - ìˆ˜í˜œ ì˜ˆìƒ ì´ìœ ]

â€¢ [ì˜ˆ: NVDA(ì—”ë¹„ë””ì•„) - AI ë°˜ë„ì²´ ìˆ˜ìš” ì¦ê°€ ìˆ˜í˜œ]

### c. ì˜¤ëŠ˜ì˜ ì£¼ì‹ ì´ë²¤íŠ¸

â€¢ [FOMC, CPI, PPI, ê³ ìš©ì§€í‘œ, ì‹¤ì ë°œí‘œ ë“± ì˜¤ëŠ˜ ì˜ˆì •ëœ ì´ë²¤íŠ¸]

â€¢ [ì´ë²¤íŠ¸ê°€ ì—†ìœ¼ë©´ "ì˜¤ëŠ˜ ì£¼ìš” ì´ë²¤íŠ¸ ì—†ìŒ"ìœ¼ë¡œ í‘œì‹œ]

### d. Upcoming ì´ë²¤íŠ¸

â€¢ [ì´ë²ˆ ì£¼/ë‹¤ìŒ ì£¼ ì˜ˆì •ëœ ì£¼ìš” ê²½ì œ ì´ë²¤íŠ¸]

â€¢ [FOMC íšŒì˜, CPI/PPI ë°œí‘œ, ê³ ìš©ì§€í‘œ, ì£¼ìš” ê¸°ì—… ì‹¤ì ë°œí‘œ ì¼ì •]

â€¢ [ì‹œì¥ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆëŠ” ì˜ˆì •ëœ ì´ë²¤íŠ¸ ë¯¸ë¦¬ë³´ê¸°]


## 3. ì˜¤ëŠ˜ì˜ í•« í† í”½

â€¢ [ê°€ì¥ í™”ì œê°€ ëœ ì£¼ì œ]

â€¢ [ë‘ ë²ˆì§¸ í™”ì œ]


## 4. ì˜¤ëŠ˜ì˜ AI/ê¸°ìˆ  íŠ¸ë Œë“œ

â€¢ [ì£¼ìš” ë°œí‘œ, ìƒˆë¡œìš´ ê¸°ìˆ , ì—…ê³„ ë™í–¥]

â€¢ [AI ê´€ë ¨ ì£¼ìš” ë‰´ìŠ¤]


## 5. ê°œë°œ ì—…ë°ì´íŠ¸

### a. Vibe Coding

â€¢ [Claude Code ì—…ë°ì´íŠ¸, ìƒˆ ê¸°ëŠ¥, í™œìš© íŒ (ë©”ì¸)]

â€¢ [Cursor, Windsurf, Copilot ë“± AI ì½”ë”© ì—ì´ì „íŠ¸ ì†Œì‹]

â€¢ [Vibe Coding ì›Œí¬í”Œë¡œìš°, í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ íŒ]

â€¢ [AI í˜ì–´ í”„ë¡œê·¸ë˜ë° ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤, ìƒì‚°ì„± í–¥ìƒ ë…¸í•˜ìš°]

### b. AI ëª¨ë¸ & API

â€¢ [GPT, Gemini, Grok, Claude ë“± AI ëª¨ë¸ ì—…ë°ì´íŠ¸]

â€¢ [AI API í™œìš©ë²•, ìƒˆë¡œìš´ ê¸°ëŠ¥ ì†Œê°œ]

### c. ê°œë°œ íŠ¸ë Œë“œ

â€¢ [DEV.to, Hacker News ë“±ì—ì„œ ìˆ˜ì§‘ëœ ê°œë°œ ê´€ë ¨ ì†Œì‹]

â€¢ [í”„ë¡œê·¸ë˜ë° ì–¸ì–´, í”„ë ˆì„ì›Œí¬, ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë ¨ ì†Œì‹]


## 6. ì¸ì‚¬ì´íŠ¸

[ì „ì²´ ë°ì´í„°ë¥¼ ì¢…í•©í•œ 2-3ë¬¸ì¥ ì¸ì‚¬ì´íŠ¸. ì•ìœ¼ë¡œì˜ ë°©í–¥ì„±ì´ë‚˜ ì£¼ëª©í•  ì ]

---
ë§Œì•½ íŠ¹ì • ì¹´í…Œê³ ë¦¬ì— ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ "ìƒˆë¡œìš´ ì—…ë°ì´íŠ¸ ì—†ìŒ"ìœ¼ë¡œ í‘œì‹œí•˜ì„¸ìš”.
ì£¼ì‹ ê´€ë ¨ ë¶„ì„ì€ ìˆ˜ì§‘ëœ ë°ì´í„°ì™€ ì¼ë°˜ì ì¸ ì‹œì¥ ì§€ì‹ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.
ê° bullet point ì‚¬ì´ì— ë¹ˆ ì¤„ì„ ë„£ì–´ ê°€ë…ì„±ì„ ë†’ì—¬ì£¼ì„¸ìš”.
"""

        try:
            response = self.model.generate_content(prompt)
            return response.text
        except Exception as e:
            return f"ë¶„ì„ ì‹¤íŒ¨: {e}"

    def create_report_header(self) -> str:
        """ë¦¬í¬íŠ¸ í—¤ë” ìƒì„±"""
        kst = pytz.timezone('Asia/Seoul')
        now_kst = datetime.now(kst)
        return f"ğŸ“Š íŠ¸ë Œë“œ ë¦¬í¬íŠ¸ | {now_kst.strftime('%Y-%m-%d %H:%M')} KST"
